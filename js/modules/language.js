const translations = {
  uk: {
    'nav.services': 'Послуги',
    'nav.tariffs': 'Тарифи',
    'nav.app': 'Додаток',
    'nav.reviews': 'Відгуки',
    'nav.contacts': 'Контакти',

    'menu.open': 'Відкрити меню',

    'hero.title': 'Швидке таксі <span class="hero__title--highlight">Turbo Taxi</span>',
    'hero.subtitle':
      'Твій комфорт — наш пріоритет. <br class="hero__br" /> Відчуй швидкість та преміальний сервіс у кожній поїздці.',
    'hero.button': 'Викликати TAXI',

    'services.title': 'Наші Послуги',
    'services.delivery.title': 'Доставка',
    'services.delivery.text': 'Продукти, ліки, пошта та передачі. Доставимо швидко прямо до твоїх дверей.',
    'services.rental.title': 'Авто на час',
    'services.rental.text': 'Замовляй машину на певну годину. Ми будемо вчасно, щоб ти нікуди не запізнився.',
    'services.driver.title': 'Тверезий водій',
    'services.driver.text': 'Відпочивай спокійно. Наш професійний водій безпечно доставить тебе і твоє авто додому.',
    'services.transfer.title': 'Трансфери',
    'services.transfer.text': 'Групові поїздки мікроавтобусом. Ідеально для великих компаній та подорожей.',
    'services.order': 'Замовити',

    'tariffs.title': 'Наші Тарифи',
    'tariffs.city.title': 'Поїздки по місту та області',
    'tariffs.city.minimal': 'Мінімальне замовлення (до 2 км)',
    'tariffs.city.within': 'По місту (після 2 км)',
    'tariffs.city.outside': 'За місто',
    'tariffs.city.waiting': 'Очікування (простій)',
    'tariffs.extra.title': 'Додаткові послуги',
    'tariffs.extra.courier': "Кур'єрська доставка",
    'tariffs.extra.sober': 'Тверезий водій',
    'tariffs.extra.pets': 'Перевезення тварин',
    'tariffs.extra.minibus': 'Трансфер (мікроавтобус)',

    'app.title': 'Наш мобільний додаток',
    'app.feature1': 'Відстеження авто в реальному часі',
    'app.feature2': 'Попередня вартість поїздки',
    'app.feature3': 'Зручна оплата карткою',
    'app.googlePlay': 'Google Play',
    'app.appStore': 'App Store',
    'app.android': 'Android',
    'app.ios': 'iOS (iPhone)',
    'app.scanHint': 'Наведіть камеру',

    'reviews.title': 'Що про нас кажуть пасажири',
    'reviews.moreButton': 'Більше відгуків на Google Maps',

    'footer.description':
      'Turbo Taxi — ваш надійний партнер у поїздках по місту та за його межі. Швидко, безпечно та завжди вчасно.',
    'footer.navigation': 'Навігація',
    'footer.contact': "Зв'яжіться з нами",
    'footer.copyright': '© 2026 Turbo Taxi. Всі права захищені.',

    'language.label': 'Мова:',
  },

  en: {
    'nav.services': 'Services',
    'nav.tariffs': 'Tariffs',
    'nav.app': 'App',
    'nav.reviews': 'Reviews',
    'nav.contacts': 'Contacts',

    'menu.open': 'Open menu',

    'hero.title': 'Fast Taxi <span class="hero__title--highlight">Turbo Taxi</span>',
    'hero.subtitle':
      'Your comfort is our priority. <br class="hero__br" /> Experience speed and premium service on every trip.',
    'hero.button': 'Call TAXI',

    'services.title': 'Our Services',
    'services.delivery.title': 'Delivery',
    'services.delivery.text': "Products, medicines, mail, and parcels. We'll deliver quickly right to your door.",
    'services.rental.title': 'Car Rental by Hour',
    'services.rental.text': "Book a car for a specific time. We'll be on time so you won't be late anywhere.",
    'services.driver.title': 'Sober Driver',
    'services.driver.text': 'Rest easy. Our professional driver will safely deliver you and your car home.',
    'services.transfer.title': 'Transfers',
    'services.transfer.text': 'Group trips by minibus. Perfect for large companies and journeys.',
    'services.order': 'Order',

    'tariffs.title': 'Our Tariffs',
    'tariffs.city.title': 'City and Regional Trips',
    'tariffs.city.minimal': 'Minimum order (up to 2 km)',
    'tariffs.city.within': 'Within the city (after 2 km)',
    'tariffs.city.outside': 'Outside the city',
    'tariffs.city.waiting': 'Waiting (idle time)',
    'tariffs.extra.title': 'Additional Services',
    'tariffs.extra.courier': 'Courier delivery',
    'tariffs.extra.sober': 'Sober driver',
    'tariffs.extra.pets': 'Pet transportation',
    'tariffs.extra.minibus': 'Transfer (minibus)',

    'app.title': 'Our Mobile App',
    'app.feature1': 'Real-time car tracking',
    'app.feature2': 'Estimated trip cost',
    'app.feature3': 'Convenient card payment',
    'app.googlePlay': 'Google Play',
    'app.appStore': 'App Store',
    'app.android': 'Android',
    'app.ios': 'iOS (iPhone)',
    'app.scanHint': 'Point your camera',

    'reviews.title': 'What Our Passengers Say',
    'reviews.moreButton': 'More Reviews on Google Maps',

    'footer.description':
      'Turbo Taxi is your reliable partner for city trips and beyond. Fast, safe, and always on time.',
    'footer.navigation': 'Navigation',
    'footer.contact': 'Contact Us',
    'footer.copyright': '© 2026 Turbo Taxi. All rights reserved.',

    'language.label': 'Language:',
  },

  pl: {
    'nav.services': 'Usługi',
    'nav.tariffs': 'Cennik',
    'nav.app': 'Aplikacja',
    'nav.reviews': 'Opinie',
    'nav.contacts': 'Kontakt',

    'menu.open': 'Otwórz menu',

    'hero.title': 'Szybka taksówka <span class="hero__title--highlight">Turbo Taxi</span>',
    'hero.subtitle':
      'Twój komfort to nasz priorytet. <br class="hero__br" /> Doświadcz szybkości i premium serwisu w każdej podróży.',
    'hero.button': 'Zadzwoń TAXI',

    'services.title': 'Nasze Usługi',
    'services.delivery.title': 'Dostawa',
    'services.delivery.text': 'Produkty, leki, poczta i przesyłki. Dostarczymy szybko prosto pod twoje drzwi.',
    'services.rental.title': 'Auto na godzinę',
    'services.rental.text': 'Zamów samochód na określoną godzinę. Będziemy na czas, żebyś się nigdzie nie spóźnił.',
    'services.driver.title': 'Trzeźwy kierowca',
    'services.driver.text':
      'Odpocznij spokojnie. Nasz profesjonalny kierowca bezpiecznie zawiezie ciebie i twój samochód do domu.',
    'services.transfer.title': 'Transfery',
    'services.transfer.text': 'Podróże grupowe busem. Idealne dla dużych firm i wycieczek.',
    'services.order': 'Zamów',

    'tariffs.title': 'Nasz Cennik',
    'tariffs.city.title': 'Przejazdy po mieście i regionie',
    'tariffs.city.minimal': 'Minimalne zamówienie (do 2 km)',
    'tariffs.city.within': 'W mieście (po 2 km)',
    'tariffs.city.outside': 'Poza miastem',
    'tariffs.city.waiting': 'Oczekiwanie (postój)',
    'tariffs.extra.title': 'Dodatkowe usługi',
    'tariffs.extra.courier': 'Dostawa kurierska',
    'tariffs.extra.sober': 'Trzeźwy kierowca',
    'tariffs.extra.pets': 'Transport zwierząt',
    'tariffs.extra.minibus': 'Transfer (bus)',

    'app.title': 'Nasza aplikacja mobilna',
    'app.feature1': 'Śledzenie samochodu w czasie rzeczywistym',
    'app.feature2': 'Szacowany koszt podróży',
    'app.feature3': 'Wygodna płatność kartą',
    'app.googlePlay': 'Google Play',
    'app.appStore': 'App Store',
    'app.android': 'Android',
    'app.ios': 'iOS (iPhone)',
    'app.scanHint': 'Skieruj kamerę',

    'reviews.title': 'Co mówią nasi pasażerowie',
    'reviews.moreButton': 'Więcej opinii na Google Maps',

    'footer.description':
      'Turbo Taxi — twój niezawodny partner w podróżach po mieście i poza nim. Szybko, bezpiecznie i zawsze na czas.',
    'footer.navigation': 'Nawigacja',
    'footer.contact': 'Skontaktuj się z nami',
    'footer.copyright': '© 2026 Turbo Taxi. Wszystkie prawa zastrzeżone.',

    'language.label': 'Język:',
  },
}

function getLanguageName(lang) {
  const names = {
    uk: 'Українська',
    en: 'English',
    pl: 'Polski',
  }
  return names[lang] || lang
}

function getLanguageCode(lang) {
  const codes = {
    uk: 'UA',
    en: 'EN',
    pl: 'PL',
  }
  return codes[lang] || lang.toUpperCase()
}

function updateCompactButton(lang) {
  const compactBtn = document.querySelector('.lang-btn-compact')
  if (compactBtn) {
    compactBtn.innerHTML = `
      <span class="lang-code">${getLanguageCode(lang)}</span>
    `
    compactBtn.dataset.lang = lang
    compactBtn.title = getLanguageName(lang)

    if (compactBtn.dataset.lang === lang) {
      compactBtn.classList.add('active')
    } else {
      compactBtn.classList.remove('active')
    }
  }
}

function updateDropdownOptions(lang) {
  const langNames = {
    uk: 'Українська',
    en: 'English',
    pl: 'Polski',
  }

  document.querySelectorAll('.lang-option').forEach(option => {
    const optionLang = option.dataset.lang

    if (langNames[optionLang]) {
      option.textContent = langNames[optionLang]
    }

    if (optionLang === lang) {
      option.classList.add('active')
    } else {
      option.classList.remove('active')
    }
  })
}

function switchLanguage(lang) {
  if (!translations[lang]) return

  localStorage.setItem('language', lang)
  document.documentElement.lang = lang

  // всі елементи з data-i18n
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.dataset.i18n
    const value = translations[lang][key]

    if (value) {
      // Перевіряємо, чи є HTML в тексті
      if (value.includes('<')) {
        element.innerHTML = value
      } else {
        element.textContent = value
      }
      if (element.hasAttribute('placeholder')) {
        element.setAttribute('placeholder', value)
      }
      if (element.hasAttribute('title')) {
        element.setAttribute('title', value)
      }
      if (element.hasAttribute('aria-label')) {
        const baseLabel = element.getAttribute('data-original-label') || element.getAttribute('aria-label')
        element.setAttribute('aria-label', value)
        if (!element.hasAttribute('data-original-label')) {
          element.setAttribute('data-original-label', baseLabel)
        }
      }
    }
  })

  updateActiveButton(lang)
  updateCompactButton(lang)
  updateDropdownOptions(lang)

  console.log('Language switched to:', lang)
}

function updateActiveButton(lang) {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    if (btn.dataset.lang === lang) {
      btn.classList.add('active')
      btn.setAttribute('aria-current', 'true')
    } else {
      btn.classList.remove('active')
      btn.removeAttribute('aria-current')
    }
  })
}

function loadSavedLanguage() {
  const savedLang = localStorage.getItem('language')
  const browserLang = navigator.language.slice(0, 2)
  const defaultLang = 'uk'

  if (savedLang && translations[savedLang]) {
    return savedLang
  } else if (translations[browserLang]) {
    return browserLang
  } else {
    return defaultLang
  }
}

// Ініціалізація
export function initLanguage() {
  document.querySelectorAll('.lang-btn, .lang-btn-compact, .lang-option').forEach(btn => {
    btn.addEventListener('click', e => {
      const lang = e.target.dataset.lang || e.target.closest('[data-lang]')?.dataset.lang
      if (lang) {
        switchLanguage(lang)
      }
    })
  })

  const currentLang = loadSavedLanguage()

  switchLanguage(currentLang)

  if (!document.querySelector('#language-switcher-styles')) {
    const style = document.createElement('style')
    style.id = 'language-switcher-styles'
    style.textContent = `
    /* Компактний перемикач мов БЕЗ ПРАПОРЦІВ */
    .language-switcher-desktop {
      position: relative;
      margin-left: 15px;
    }
    
    .lang-btn-compact {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      color: var(--color-white);
      font-family: var(--font-accent);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 60px;
      backdrop-filter: blur(10px);
    }
    
    .lang-btn-compact:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--color-primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .lang-btn-compact.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: var(--color-black);
      /* ВИДАЛЕНО анімацію пульсації */
    }
    
    .lang-btn-compact.active:hover {
      background: var(--color-primary);
      opacity: 0.9;
    }
    
    /* Випадаючий список мов БЕЗ ПРАПОРЦІВ */
    .lang-dropdown {
      position: absolute;
      top: calc(100% + 5px);
      right: 0;
      min-width: 150px;
      background: var(--color-black);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 8px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: var(--z-dropdown);
      backdrop-filter: blur(20px);
    }
    
    .language-switcher-desktop:hover .lang-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .lang-option {
      display: block;
      width: 100%;
      padding: 10px 12px;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: var(--color-white);
      font-family: var(--font-base);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
    }
    
    .lang-option:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-primary);
    }
    
    .lang-option.active {
      background: rgba(180, 213, 17, 0.2);
      color: var(--color-primary);
      font-weight: 600;
    }
    
    /* Мобільна версія перемикача БЕЗ ПРАПОРЦІВ */
    .menu__item--lang {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
    }
    
    .language-switcher-mobile {
      width: 100%;
    }
    
    .lang-label {
      color: var(--color-gray-light);
      font-size: 14px;
      margin-bottom: 10px;
      font-family: var(--font-base);
      text-align: center;
    }
    
    .lang-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    
    .lang-buttons .lang-btn {
      flex: 1;
      max-width: 80px;
      padding: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      color: var(--color-white);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .lang-buttons .lang-btn:hover,
    .lang-buttons .lang-btn.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: var(--color-black);
      font-weight: 700;
    }
    
    /* Код мови */
    .lang-code {
      font-weight: 700;
    }
    
    .lang-text {
      font-weight: 700;
    }
    
    /* Адаптація для планшетів */
    @media (max-width: 1024px) {
      .lang-btn-compact {
        padding: 7px 10px;
        min-width: 55px;
        font-size: 13px;
      }
    }
    
    /* Мобільна версія */
    @media (max-width: 768px) {
      .language-switcher-desktop {
        display: none;
      }
      
      .menu__item--lang {
        display: block;
      }
    }
    
    /* Маленькі телефони */
    @media (max-width: 480px) {
      .lang-buttons {
        gap: 6px;
      }
      
      .lang-buttons .lang-btn {
        max-width: 70px;
        padding: 8px;
        font-size: 13px;
      }
      
      .lang-label {
        font-size: 13px;
      }
    }
    
    /* Екстра малі телефони */
    @media (max-width: 360px) {
      .lang-buttons {
        gap: 4px;
      }
      
      .lang-buttons .lang-btn {
        max-width: 65px;
        padding: 7px;
        font-size: 12px;
      }
    }
    
    /* Плавний перехід для скролу */
    .header.scrolled .lang-btn-compact {
      padding: 6px 10px;
      font-size: 13px;
    }
    
    .header.scrolled .lang-dropdown {
      top: calc(100% + 3px);
    }
    `
    document.head.appendChild(style)
  }

}
